<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Reddit+Mono:wght@200..900&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Averia+Serif+Libre:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">


<title>Planner</title>
<style>
    body, input, select, button{ font-family: Averia Serif Libre, sans-serif; color: white;}
    .averia-serif libre-regular {
        font-family: "Averia Serif Libre", serif;
        font-weight: 400;
        font-style: normal;
        }
    input{
        border: 1px solid #8C52FF;
        fill-opacity: 0%;
        background-color: transparent;
        padding: 10px;
        color: white;
    }
    button{
        border: 1px solid #8C52FF;
        fill-opacity: 0%;
        background-color: #8C52FF;
        padding: 10px;
        color: white;
    }
    input::placeholder{
        color: white;
        opacity: 80%;
    }
    body {
        margin-left: 60px;
        background-image: url('bg.png');
        background-size:cover; 
        background-position: center; 
        background-repeat: no-repeat; 
        background-attachment: fixed; 
        margin-bottom: 100px;
    }
    .assignment { margin-bottom: 15px; }
    table { width: 90%;margin: 0 auto; border-collapse: collapse;border: 2px solid #8C52FF; }
    th { border: 2px solid #8C52FF; padding: 8px; text-align: left;}
    td { border: 0px solid #ddd; padding: 8px; text-align: left; }
    th {background-color: #8c52ff17; }
    .edit-icon, .delete-icon { 
    cursor: pointer; 
    margin-left: 0px; 
    width: 18px; 
    height: 18px; 
    }
    h2 {
        font-size: 23px;
    }
    #classesList{
        margin-top: 20px;
        color:white;
    }
    .top-right {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    .addButton{
        border-radius: 100px;
    height: 40px;
    width: 40px;
    }
    #classSelect{
        border: 1px solid #8C52FF;
        background-color: rgba(55, 32, 100, 0.5);
        
        padding: 10px;
        color: white;
    }
</style>
</head>
<body>  
<a href="calendar.html" class="top-right"><button>Calendar</button></a>
<a id="Title" style="
color: #b28bff;
font-size: 70px;
letter-spacing: -6.5px;
margin-top:60px;
">Planner</a>
<h2 style="color: #8C52FF;">Enter Your Classes</h2>

<form id="classForm">
    <input type="text" id="className" placeholder="Class Name" required>
    <input type="color" id="classColor"style="padding:0px;" required>
    <button class="addButton" type="submit">+</button>
</form>
<div id="classesList"></div>

<h2 style="color: #8C52FF;">Add Assignment</h2>
<form id="assignmentForm" style="display:none;">
    <input type="text" id="assignmentName" placeholder="Assignment Name" required>
    <input type="date" id="dueDate" required>
    <input type="time" id="dueTime" required value="23:59"> 
    <select id="classSelect"></select>
    <button class="addButton" type="submit">+</button>
</form>

<table id="assignmentsTable" style="display:none;margin-top: 50px;">
    <tr>
        <th>Assignment</th>
        <th>Due Date</th>
        <th>Class</th>
        <th>Actions</th>
    </tr>
</table>

<script>
let classes = JSON.parse(localStorage.getItem('classes')) || [];
let assignments = JSON.parse(localStorage.getItem('assignments')) || [];
function formatDate(dateString) {
    const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    const date = new Date(dateString);
    const dayOfWeek = daysOfWeek[date.getDay()];
    const monthName = months[date.getMonth()];
    const dayOfMonth = date.getDate();
    const year = date.getFullYear();

    // Convert 24-hour time to 12-hour format
    let hours = date.getHours();
    const minutes = date.getMinutes().toString().padStart(2, '0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'

    return `${dayOfWeek}, ${monthName} ${dayOfMonth}, ${year} at ${hours}:${minutes} ${ampm}`;
}




function updateClassSelect() {
    const select = document.getElementById('classSelect');
    select.innerHTML = classes.map(c => `<option value="${c.name}" style="color: ${c.color};">${c.name}</option>`).join('');
}

function updateClassesList() {
    const list = document.getElementById('classesList');
    list.innerHTML = classes.map((c, index) => `<div class="class-entry" style="text-decoration: underline;
    text-decoration-color: ${c.color}; 
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;">${c.name}
        <img src="icons/edit_icon_white.png" class="edit-icon" onclick="editClass(${index})">
        <img src="icons/delete_icon_white.png" class="delete-icon" onclick="deleteClass(${index})">
    </div>`).join('');
    updateClassSelect();
}
function hexToRGBA(hex, opacity) {
    let r = 0, g = 0, b = 0;
    // 3 digits
    if (hex.length == 4) {
        r = parseInt(hex[1] + hex[1], 16);
        g = parseInt(hex[2] + hex[2], 16);
        b = parseInt(hex[3] + hex[3], 16);
    }
    // 6 digits
    else if (hex.length == 7) {
        r = parseInt(hex[1] + hex[2], 16);
        g = parseInt(hex[3] + hex[4], 16);
        b = parseInt(hex[5] + hex[6], 16);
    }
    return `rgba(${r}, ${g}, ${b}, ${opacity})`;
}
function updateAssignmentsTable() {
    const table = document.getElementById('assignmentsTable');
    if (assignments.length > 0) {
        table.style.display = '';
        table.innerHTML = '<tr><th>Assignment</th><th>Due Date</th><th>Class</th><th>Actions</th></tr>' +
            assignments.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
            .map((a, index) => `<tr>
    <td><span class="text-style" style="text-decoration: underline;
    text-decoration-color: ${a.color}; 
    text-decoration-thickness: 2px;
    text-underline-offset: 3px; "">${a.name}</span></td>
    <td><span class="text-style" style="text-decoration: underline;
    text-decoration-color: ${a.color}; 
    text-decoration-thickness: 2px;
    text-underline-offset: 3px; " ">${formatDate(a.dueDate)}</span></td>
    <td><span class="text-style" style="background-color: ${hexToRGBA(a.color, 0.6)};
         border-radius: 15px;padding: 5px;border= 2px solid ${a.color};padding-left: 10px; 
             padding-right: 10px;">${a.className}</span></td>
    <td>
        <img src="icons/edit_icon_white.png" class="edit-icon" onclick="editAssignment(${index})">
        <img src="icons/delete_icon_white.png" class="delete-icon" onclick="deleteAssignment(${index})">
    </td>
</tr>`).join('');
    } else {
        table.style.display = 'none';
    }
}

function editClass(index) {
    const className = prompt("Edit class name:", classes[index].name);
    const classColor = prompt("Edit class color (hex format):", classes[index].color);
    if (className !== null && classColor !== null) {
        classes[index] = { name: className, color: classColor };
        localStorage.setItem('classes', JSON.stringify(classes));
        updateClassesList();
        updateAssignmentsTable();
    }
}

function deleteClass(index) {
    if (confirm("Are you sure you want to delete this class?")) {
        classes.splice(index, 1);
        localStorage.setItem('classes', JSON.stringify(classes));
        updateClassesList();
        updateAssignmentsTable();
    }
}

function editAssignment(index) {
    const assignmentName = prompt("Edit assignment name:", assignments[index].name);
    const dueDate = prompt("Edit due date (YYYY-MM-DD):", assignments[index].dueDate);
    if (assignmentName !== null && dueDate !== null) {
        assignments[index].name = assignmentName;
        assignments[index].dueDate = dueDate;
        localStorage.setItem('assignments', JSON.stringify(assignments));
        updateAssignmentsTable();
    }
}

function deleteAssignment(index) {
    if (confirm("Are you sure you want to delete this assignment?")) {
        assignments.splice(index, 1);
        localStorage.setItem('assignments', JSON.stringify(assignments));
        updateAssignmentsTable();
    }
}

document.getElementById('classForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('className').value;
    const color = document.getElementById('classColor').value;
    classes.push({name, color});
    localStorage.setItem('classes', JSON.stringify(classes));
    updateClassSelect();
    updateClassesList();
    document.getElementById('assignmentForm').style.display = '';
    this.reset();
});

document.getElementById('assignmentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('assignmentName').value;
    const dueDate = document.getElementById('dueDate').value;
    const dueTime = document.getElementById('dueTime').value; // Retrieve time
    const className = document.getElementById('classSelect').value;
    const classColor = classes.find(c => c.name === className).color;
    const startDateTime = `${dueDate}T${dueTime}`;
    assignments.push({name, dueDate: startDateTime, className, color: classColor}); // Fixed: Use 'dueDate' to hold the full datetime
    localStorage.setItem('assignments', JSON.stringify(assignments));
    updateAssignmentsTable();
    this.reset();
});


window.onload = function() {
    if (classes.length > 0) {
        document.getElementById('assignmentForm').style.display = '';
        updateClassSelect();
        updateClassesList();
    }
    updateAssignmentsTable();
};

</script>

</body>
</html>

<!-- 
    -edit button
    -remove class
    -color completo
    -calendar format
 -->